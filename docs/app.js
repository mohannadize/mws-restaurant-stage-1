class DBHelper{static get DATABASE_URL(){return"data/restaurants.json"}static fetchRestaurants(e){db.getAll().then(t=>t.length?(e(null,t),1):fetch(DBHelper.DATABASE_URL).then(e=>e.json()).then(t=>{e(null,t),t.map(e=>(db.set(e),1))}))}static fetchRestaurantById(e,t){db.get(parseFloat(e)).then(e=>(t(null,e),1)).catch(e=>{console.log(e)})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){let t=[e.photograph+"-800.jpg",e.photograph+"-400.jpg"];return t=t.map(e=>`img/${e}`)}static async favorite(e){let t=await db.get(e),n=!t.is_favorite;t.is_favorite=n,db.set(t),fetch(`http://${location.hostname}:1337/restaurants/${e}/?is_favorite=${n}`,{method:"PUT"}).then(e=>e.json())}}const starIcon='<svg version="1.1" class="Capa_1" width="1.5em" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-5 -6 55 55" xml:space="preserve">   <path class="star-icon" d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757       c2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042       c0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685       c-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528       c-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956       C22.602,0.567,25.338,0.567,26.285,2.486z"/>   </svg>';class RatingSelection{constructor(e){this.ele=document.createElement("div"),e&&(this.target_input=e),this.rating=null,this.ele.setAttribute("role","radiogroup"),this.ele.setAttribute("aria-label","Your Rating"),this.ele.addEventListener("keydown",e=>{(39==e.keyCode||37==e.keyCode)&&e.preventDefault(),null==this.rating?this.rating=1:39===e.keyCode?this.rating<5&&this.rating++:37===e.keyCode&&this.rating>1&&this.rating--,this.refresh()}),this.stars=[],this.ele.tabIndex=0,this.ele.style.display="inline-block";for(let e=0;e<5;e++){let t=document.createElement("a");t.innerHTML=starIcon,t.setAttribute("data-rating",e+1),t.style.cursor="pointer",t.style.padding="0.25em",t.setAttribute("role","radio"),this.stars.push(t),this.ele.appendChild(t),t.addEventListener("mouseenter",e=>{this.stars.forEach(t=>{t.dataset.rating<=e.currentTarget.dataset.rating?t.children[0].children[0].style.fill="orange":t.children[0].children[0].style.fill="transparent"})}),t.addEventListener("mouseleave",()=>this.refresh()),t.onclick=(e=>{this.rating=e.currentTarget.dataset.rating,this.refresh()})}}refresh(){this.rating?(this.ele.setAttribute("aria-valuenow",this.rating+(1==this.rating?" star":" stars")),this.target_input&&(this.target_input.value=this.rating),this.stars.forEach(e=>{e.dataset.rating<=this.rating?e.children[0].children[0].style.fill="orange":e.children[0].children[0].style.fill="transparent"})):this.stars.forEach(e=>{e.children[0].children[0].style.fill="transparent"})}}if(-1===location.pathname.search("restaurant.html")){var markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{document.querySelector("#map img").src="https://www.mapquestapi.com/staticmap/v5/map?locations=40.713829,-73.989667|marker-sm-cc0000-000000||40.683555,-73.966393|marker-sm-cc0000-000000||40.747143,-73.985414|marker-sm-cc0000-000000||40.722216,-73.987501|marker-sm-cc0000-000000||40.705089,-73.933585|marker-sm-cc0000-000000||40.674925,-74.016162|marker-sm-cc0000-000000||40.727397,-73.983645|marker-sm-cc0000-000000||40.726584,-74.002082|marker-sm-cc0000-000000||40.743797,-73.950652|marker-sm-cc0000-000000||40.743394,-73.954235|marker-sm-cc0000-000000&key=oDfUd4gVTtidN7UmyZO07vm4KR8re4ak&size="+window.innerWidth+",400",updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,s=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))});new LazyLoad({elements_selector:".restaurant-img"})}),createRestaurantHTML=(e=>{const t=document.createElement("li");e.is_favorite&&t.classList.add("favorite");const n=document.createElement("div"),r=document.createElement("article"),a=document.createElement("a");a.classList.add("fav-btn"),a.innerHTML=starIcon,a.href="javascript:void(0)",a.setAttribute("aria-label",`Favorite ${e.name} restaurant.`),a.setAttribute("role","button"),a.onclick=(t=>{t.currentTarget.parentNode.parentNode.classList.toggle("favorite"),DBHelper.favorite(e.id),document.activeElement.blur()}),a.addEventListener("keydown",function(e){13!=e.keyCode&&32!=e.keyCode||(e.preventDefault(),this.click())}),n.className="details";const s=document.createElement("img");s.className="restaurant-img",s.setAttribute("alt",`${e.name} restaurant.`);const i=DBHelper.imageUrlForRestaurant(e);s.dataset.srcset=`${i[1]} 600w, ${i[0]} 1200w`,s.dataset.src=i[0];const o=document.createElement("h3");o.innerHTML=e.name,n.append(o);const l=document.createElement("p");l.innerHTML=e.neighborhood,n.append(l);const c=document.createElement("p");c.innerHTML=e.address,n.append(c);const d=document.createElement("a");return d.classList.add("details-btn"),d.innerHTML="View Details",d.setAttribute("aria-label",`More details about ${e.name} restaurant`),d.href=DBHelper.urlForRestaurant(e),n.append(d),r.append(s),r.append(n),r.append(a),t.append(r),t}),window.initMap()}if("serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"./"}),function(){const e=document.querySelector("body");let t=document.createElement("a");t.innerText="Test",t.onclick=(()=>{console.log("Button is fkn working"),navigator.serviceWorker.ready.then(e=>(console.log("1"),e.sync.register("poop"))).then(e=>{console.log("Sync Reg")}).catch(e=>console.error(e)),console.log("last")}),e.append(t)}(),1===location.pathname.search("restaurant.html")){var map;window.init=(()=>{let e=document.querySelector("#map");document.querySelector("#map img").src="https://www.mapquestapi.com/staticmap/v5/map?locations=40.713829,-73.989667|marker-sm-cc0000-000000||40.683555,-73.966393|marker-sm-cc0000-000000||40.747143,-73.985414|marker-sm-cc0000-000000||40.722216,-73.987501|marker-sm-cc0000-000000||40.705089,-73.933585|marker-sm-cc0000-000000||40.674925,-74.016162|marker-sm-cc0000-000000||40.727397,-73.983645|marker-sm-cc0000-000000||40.726584,-74.002082|marker-sm-cc0000-000000||40.743797,-73.950652|marker-sm-cc0000-000000||40.743394,-73.954235|marker-sm-cc0000-000000&key=oDfUd4gVTtidN7UmyZO07vm4KR8re4ak&size="+e.offsetWidth+","+e.offsetHeight,fetchRestaurantFromURL((e,t)=>{e?console.error(e):fillBreadcrumb()})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("favorite-btn"),n=document.createElement("a");n.innerHTML="<span>Favorite</span> "+starIcon,n.href="javascript:void(0)",n.setAttribute("aria-label",`Favorite ${e.name} restaurant`),n.setAttribute("role","button"),self.restaurant.is_favorite&&n.classList.add("active"),n.onclick=function(){this.classList.toggle("active"),this.blur(),DBHelper.favorite(e.id)},n.addEventListener("keydown",function(e){13!=e.keyCode&&32!=e.keyCode||(e.preventDefault(),this.click())}),t.appendChild(n),document.getElementById("restaurant-address").innerHTML=e.address;const r=document.getElementById("restaurant-img");r.className="restaurant-img",r.setAttribute("alt",`An image of the ${e.name} restaurant.`);const a=DBHelper.imageUrlForRestaurant(e);r.src=a[0],r.setAttribute("srcset",`${a[1]} 400w, ${a[0]} 800w`),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fetch(`http://${location.hostname}:1337/reviews/?restaurant_id=`+e.id).then(e=>e.json()).then(e=>fillReviewsHTML(e))}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const s=document.createElement("td");s.innerHTML=e[n],r.appendChild(s),t.appendChild(r)}});function initRatings(){let e=document.getElementById("ratingCont"),t=document.getElementById("user-rating"),n=new RatingSelection(t);e.append(n.ele)}fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container");t.tabIndex=0;const n=document.createElement("h3");n.innerHTML="Reviews",t.appendChild(n);const r=document.createElement("form");r.setAttribute("aria-label","Leave a comment"),r.tabIndex=0,r.style.position="relative",r.method="POST",r.name="post-comment";const a=document.createElement("h3");a.innerHTML="Leave a comment";const s=document.createElement("div");s.classList.add("thank-div");const i=document.createElement("input");i.setAttribute("type","text"),i.name="user-name",i.setAttribute("required","true"),i.setAttribute("placeholder","Your name"),i.setAttribute("aria-label","Your name");const o=document.createElement("div");let l=document.createElement("input");l.id="user-rating",l.type="hidden",l.name="user-rating",o.id="ratingCont",o.innerHTML="<span style='vertical-align:0.25em'>Rating </span>",o.append(l);const c=document.createElement("textarea");c.setAttribute("type","text"),c.setAttribute("required","true"),c.name="user-comment",c.setAttribute("aria-label","What would you like to say?"),c.setAttribute("placeholder","What would you like to say?");const d=document.createElement("a");if(d.setAttribute("role","button"),d.style.cursor="pointer",d.tabIndex=0,d.addEventListener("keydown",function(e){13!=e.keyCode&&32!=e.keyCode||(e.preventDefault(),this.click())}),d.onclick=(e=>{let t;if([].slice.apply(document.forms[0]).reverse().forEach(e=>{if(e.value);else if(t=1,"user-rating"!=e.name)e.focus();else{document.querySelector("#ratingCont > div").focus()}}),t)return;let n={restaurant_id:self.restaurant.id,name:document.forms[0]["user-name"].value,rating:document.forms[0]["user-rating"].value,comments:document.forms[0]["user-comment"].value};!navigator.onLine&&navigator.serviceWorker&&"activated"===navigator.serviceWorker.controller.state?navigator.serviceWorker.ready.then(e=>db.set(n,db.toBe).then(()=>{e.sync.register("post-comment").then(e=>{let t=document.querySelector(".thank-div");t.innerText="Your comment will be posted as soon as you are online.",t.classList.toggle("show"),setTimeout(()=>{t.classList.toggle("show")},3e3),[].slice.apply(document.forms[0]).forEach(e=>e.value="")}).catch(e=>{alert("An error has occured."),console.error(e)})}).catch(e=>(alert("An error has occured."),console.error(e),0))):fetch(`http://${location.hostname}:1337/reviews/`,{method:"POST",body:JSON.stringify(n)}).then(e=>e.json()).then(e=>{const t=document.getElementById("reviews-list");[].slice.apply(document.forms[0]).forEach(e=>e.value=""),t.appendChild(createReviewHTML(e));let n=document.querySelector(".thank-div");n.innerText="Thank You",n.classList.toggle("show"),setTimeout(()=>{n.classList.toggle("show")},3e3)}).catch(e=>console.error(e))}),d.classList.add("submit-btn"),d.innerHTML="Submit",r.appendChild(a),r.appendChild(s),r.appendChild(i),r.append(o),r.appendChild(c),r.innerHTML+="<br>",r.appendChild(d),!e){const e=document.createElement("p");return t.setAttribute("aria-label","Reviews. No reviews yet!"),e.innerHTML="No reviews yet!",t.appendChild(e),t.appendChild(r),void initRatings()}const u=document.getElementById("reviews-list");e.forEach(e=>{u.appendChild(createReviewHTML(e))}),t.appendChild(u),t.appendChild(r),initRatings()}),createReviewHTML=(e=>{const t=document.createElement("li"),n=[document.createElement("div"),document.createElement("div")],r=document.createElement("p"),a=document.createElement("div");a.className="dividor",r.innerHTML=e.name,n[0].appendChild(r);const s=document.createElement("p");s.innerHTML=new Date(e.createdAt).toLocaleString(),n[0].appendChild(s);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,n[1].appendChild(i),t.appendChild(n[0]),t.appendChild(n[1]),t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.getElementById("favorite-btn");n.id="favorite-btn";const r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),window.init()}